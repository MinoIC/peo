<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title>{{.webApplicationName}} 用户控制台</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {{template "tpls/perfectCSS.html" .}}
</head>

<body class="overflow-hidden">
{{template "tpls/navbar.html" .}}
<div id="overlay" class="transparent"></div>
<div id="wrapper" class="sidebar-mini">
    {{template "tpls/sidebar.html" .}}
    <!-- main-container -->
    <div id="main-container">
        <div class="padding-md">
            <div class="row">
                <div class="panel panel-default fadeInDown animation-delay1">
                    <div class="panel-heading">
                        <h4><strong>余额充值</strong></h4>
                    </div>
                    <div class="panel-body">
                        <div class="col-md-3">
                            <div class="section-header">
                                <h4>账户余额</h4>
                                <img src="../static/img/wallet1.png" style="width: auto;height: 120px" alt="">
                                <h2>{{.balance}} <small>CNY</small></h2>
                                <a class="btn-success btn btn-sm" href="/">购买套餐</a>
                            </div>
                        </div>
                        <div class="col-md-2 col-md-offset-1">
                            <div class="panel panel-default panel-stat1 bg-warning">
                                <a href="#RechargeByKey" data-toggle="tab">
                                    <div class="panel-body text-white">
                                        <div class="value">
                                            <svg t="1582901509056" class="icon" viewBox="0 0 1496 1024" version="1.1"
                                                 xmlns="http://www.w3.org/2000/svg" p-id="14312" width="48" height="48">
                                                <path d="M409.915077 269.312a78.532923 78.532923 0 0 0 0-110.355692l-1.024-1.024a76.8 76.8 0 0 0-109.331692 0L22.685538 437.405538a78.611692 78.611692 0 0 0 0 110.434462l276.873847 279.473231a76.8 76.8 0 0 0 109.331692 0l1.024-1.024a78.532923 78.532923 0 0 0 0-110.355693L243.396923 547.84a78.611692 78.611692 0 0 1 0-110.434462l166.518154-168.093538z m1064.014769 168.093538l-276.873846-279.47323a76.8 76.8 0 0 0-109.331692 0l-1.024 1.024a78.532923 78.532923 0 0 0 0 110.355692l166.596923 168.093538a78.611692 78.611692 0 0 1 0 110.434462l-166.596923 168.093538a78.532923 78.532923 0 0 0 0 110.355693l1.024 1.024a76.8 76.8 0 0 0 109.331692 0l276.873846-279.473231a78.611692 78.611692 0 0 0 0-110.434462zM1009.033846 110.907077l-398.729846 853.070769c-12.918154 26.860308-35.603692 60.022154-64.827077 60.022154h-1.575385c-56.792615 0-93.892923-77.193846-68.765538-129.260308L871.502769 49.624615c12.918154-26.781538 60.809846-47.734154 60.809846-47.734153V0c77.351385 0 101.769846 58.840615 76.642462 110.907077z"
                                                      p-id="14313" fill="#ffffff"></path>
                                            </svg>
                                        </div>
                                        <div class="title">
                                            <span class="m-left-xs"><strong>激活码</strong></span>
                                        </div>
                                    </div>
                                </a>
                            </div>
                            {{if .aliEnabled}}
                                 <div class="panel panel-default panel-stat1 bg-info">
                                <a href="#RechargeByZFB" data-toggle="tab">
                                    <div class="panel-body text-white">
                                        <div class="value">
                                            <svg t="1598279702458" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1518" width="64" height="64"><path d="M873.6 713.6c-1.4-0.6-93.4-53.6-262.1-121.7 46.7-69.3 78.7-138.6 80.4-142.4 1.8-4 1.7-8.4 0.1-12.1-0.2-0.4-0.4-0.9-0.6-1.3-0.2-0.4-0.5-0.8-0.7-1.2-0.3-0.4-0.5-0.7-0.8-1.1l-0.1-0.1c-0.3-0.3-0.6-0.7-0.9-1 0-0.1-0.1-0.1-0.2-0.1l-0.8-0.8c-0.1-0.1-0.2-0.2-0.4-0.3-0.2-0.2-0.4-0.3-0.7-0.5-0.3-0.2-0.5-0.3-0.8-0.5-0.1-0.1-0.2-0.1-0.3-0.2-2.2-1.3-4.8-2-7.5-2h-152v-46h179c8.2 0 15-6.7 15-15s-6.7-15-15-15h-179v-68c0-8.3-6.7-15-15-15s-15 6.7-15 15v68h-181c-8.3 0-15 6.7-15 15s6.7 15 15 15h181v46h-152c-8.3 0-15 6.7-15 15s6.7 15 15 15h310.1c-13.5 26.8-39.2 75.2-71.4 122.2-36.6-14.6-75.6-29.8-116.4-45.2l-0.8-0.3c-91.4-29-159.4-25.8-202.2 9.6-39.6 32.8-43.2 82.2-41.2 98.5 6.3 52.9 36.3 90.2 84.4 104.9 15.1 4.6 31.7 6.9 49.2 6.9 26.5 0 55.1-5.3 83.9-15.7 47.7-17.2 91.6-47.1 123.7-84.1 10.5-12.1 20.6-24.9 30.2-38 171.4 69 265.6 123 267 123.7 7.5 3.6 16.4 0.4 20-7.1 3.6-7.6 0.4-16.5-7.1-20.1z m-332.9-78.2c-28.8 33.1-68.3 60-111.2 75.5-41.7 15.1-82.3 18.1-114.1 8.3-36.5-11.2-58.5-38.8-63.4-79.8-1-8.9 1-47.3 30.6-71.7 17.9-14.8 43-22.2 74.4-22.2 28.2 0 61.5 5.9 99.1 17.9 38 14.3 74.3 28.5 108.6 42.1-7.7 10.3-15.8 20.4-24 29.9z" fill="#ffffff" p-id="1519"></path></svg>
                                        </div>
                                        <div class="title">
                                            <span class="m-left-xs"><strong>支付宝</strong></span>
                                        </div>
                                    </div>
                                </a>
                            </div>
                            {{end}}
                        </div>
                        <div class="col-md-5  padding-md">
                            <div class="tab-content">
                                <div class="tab-pane fade active in" id="RechargeByKey">
                                    <form class="no-margin" data-validate="parsley" novalidate="" id="FormByKey" >
                                        {{.xsrfData}}
                                        <div class="panel-heading">
                                            <h4>用激活码充值</h4>
                                            <p>您可以在淘宝或发卡平台购买到用于充值余额的激活码</p>
                                            <p>若充值后等待一分钟扔未到账，请联系网站管理员为您解决</p>
                                        </div>
                                        <div class="panel-body">
                                            <div class="form-group">
                                                <input id="keyString" name="keyString" type="text"
                                                       placeholder="输入您购买到的激活码"
                                                       class="form-control input-lg parsley-validated"
                                                       data-required="true" autocomplete="off">
                                            </div><!-- /form-group -->
                                        </div>
                                        <div class="panel-footer text-right">
                                            <button type="button" class="btn btn-info btn-lg" onclick="$.get('/user-recharge/recharge-by-key?'+$('#FormByKey').serialize(),function(data) {
                                            console.log($('#FormByKey').serialize());
                                            if (data === 'SUCCESS'){
                                                alert('充值成功！请刷新查看余额！');
                                            }else{
                                                alert('充值失败！'+data);
                                            }
                                            parent.location.reload();
                                          })
                                        "><i class="fa fa-heart"></i> 充值
                                            </button>
                                        </div>
                                    </form>
                                </div>
                                <div class="tab-pane fade" id="RechargeByZFB">
                                        <form class="no-margin" data-validate="parsley" novalidate="" id="FormByZFB">
                                            {{.xsrfData}}
                                            <div class="panel-heading">
                                                <h4>用支付宝充值</h4>
                                                <p>输入要充值的金额（正整数）后支付宝APP扫描二维码付款</p>
                                                <p>请在 10 分钟内支付，后台会在 25h 内等待您的支付消息</p>
                                                <p>支付后请刷新页面查看结果，如有异常请联系网站管理员为您解决</p>
                                            </div>
                                            <div class="panel-body">
                                                <div class="form-group">
                                                    <input name="amount" type="number"
                                                           placeholder="输入要充值的数额"
                                                           class="form-control input-lg parsley-validated"
                                                           data-required="true" autocomplete="off">
                                                </div><!-- /form-group -->
                                            </div>
                                            <div class="panel-footer text-right">
                                                <button type="button" class="btn btn-info btn-lg" data-toggle="modal" href="#zfb" onclick="$.get('/user-recharge/create-zfb?'+$('#FormByZFB').serialize(),function(data) {
                                            console.log($('#FormByZFB').serialize());
                                            console.log(data)
                                            if (data.length<=5){
                                                $('#qrtext').text('获取二维码失败，请重新生成。')
                                                $('#qrimg').attr('src','')
                                            }else{
                                                $('#qrtext').text('请用支付宝App扫码支付')
                                                $('#qrimg').attr('src','data:image/png;base64,'+data)
                                            }
                                          })
                                        "><i class="fa fa-heart"></i> 充值
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="row fadeInUp animation-delay1">
                <div class="panel panel-default table-responsive">
                    <div class="panel-heading">
                        充值记录
                        <span class="label label-info pull-right">{{.rechargeTimes}} 次充值</span>
                    </div>
                    <div class="padding-md clearfix">
                        <div id="dataTable_wrapper" class="dataTables_wrapper" role="grid">
                            <table class="table table-striped dataTable" id="dataTable"
                                   aria-describedby="dataTable_info">
                                <thead>
                                <tr role="row">
                                    <th class="ui-state-default" role="columnheader" tabindex="0"
                                        aria-controls="dataTable"
                                        rowspan="1" colspan="1" aria-sort="ascending"
                                        aria-label="No: activate to sort column descending" style="width: 100px;">
                                        <div class="DataTables_sort_wrapper">ID<span
                                                    class="DataTables_sort_icon css_right ui-icon ui-icon-triangle-1-n"></span>
                                        </div>
                                    </th>
                                    <th class="ui-state-default" role="columnheader" tabindex="0"
                                        aria-controls="dataTable"
                                        rowspan="1" colspan="1" aria-label="Price: activate to sort column ascending"
                                        style="width: 114px;">
                                        <div class="DataTables_sort_wrapper">充值方式<span
                                                    class="DataTables_sort_icon css_right ui-icon ui-icon-carat-2-n-s"></span>
                                        </div>
                                    </th>
                                    <th class="ui-state-default" role="columnheader" tabindex="0"
                                        aria-controls="dataTable"
                                        rowspan="1" colspan="1" aria-label="Product: activate to sort column ascending"
                                        style="width: 380px;">
                                        <div class="DataTables_sort_wrapper">代码<span
                                                    class="DataTables_sort_icon css_right ui-icon ui-icon-carat-2-n-s"></span>
                                        </div>
                                    </th>
                                    <th class="ui-state-default" role="columnheader" tabindex="0"
                                        aria-controls="dataTable"
                                        rowspan="1" colspan="1" aria-label="Quantity: activate to sort column ascending"
                                        style="width: 157px;">
                                        <div class="DataTables_sort_wrapper">金额<span
                                                    class="DataTables_sort_icon css_right ui-icon ui-icon-carat-2-n-s"></span>
                                        </div>
                                    </th>
                                    <th class="ui-state-default" role="columnheader" tabindex="0"
                                        aria-controls="dataTable"
                                        rowspan="1" colspan="1" aria-label="Sales: activate to sort column ascending"
                                        style="width: 116px;">
                                        <div class="DataTables_sort_wrapper">充值时间<span
                                                    class="DataTables_sort_icon css_right ui-icon ui-icon-carat-2-n-s"></span>
                                        </div>
                                    </th>
                                    <th class="ui-state-default" role="columnheader" tabindex="0"
                                        aria-controls="dataTable"
                                        rowspan="1" colspan="1" aria-label="Status: activate to sort column ascending"
                                        style="width: 152px;">
                                        <div class="DataTables_sort_wrapper">状态<span
                                                    class="DataTables_sort_icon css_right ui-icon ui-icon-carat-2-n-s"></span>
                                        </div>
                                    </th>
                                </tr>
                                </thead>
                                <tbody role="alert" aria-live="polite" aria-relevant="all">
                                {{range .rechargeLogs}}
                                    <tr class="odd">
                                        <td class="sorting_2">#{{.ID}}</td>
                                        <td class=" ">{{.Method}}</td>
                                        <td class=" ">{{.Code}}</td>
                                        <td class=" ">{{.Balance}}</td>
                                        <td class=" ">{{.Time}}</td>
                                        <td class=" ">{{.Status}}</td>
                                    </tr>
                                {{end}}
                                </tbody>
                            </table>
                        </div><!-- /.padding-md -->
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="zfb" aria-hidden="true" style="display: none;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" onclick="$('#qrtext').text('正在加载二维码...')">×</button>
                        <h4>支付宝充值</h4>
                    </div>
                    <div class="modal-body">
                        <h3 id="qrtext">
                            正在加载二维码...
                        </h3>
                        <img src="" alt="" id="qrimg">
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div>
        <!-- /main-container -->
    </div><!-- /wrapper -->
    <a href="" id="scroll-to-top" class="hidden-print"><i class="fa fa-chevron-up"></i></a>
    <!-- Logout confirmation -->
    {{template "tpls/perfectJS.html" .}}
    <script src="../static/js/qrcode.min.js"></script>
    <script src='../static/perfect/js/jquery.cookie.min.js'></script>
</body>
</html>
