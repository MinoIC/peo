<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title>{{.webApplicationName}} 订单详情</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {{template "tpls/perfectCSS.html" .}}

</head>

<body class="overflow-hidden">
{{template "tpls/navbar.html" .}}
<div id="main-container">
    <div class="row">
        <div class="col-lg-10">
            <div id="wrapper" class="preload">
                <div class="padding-md">
                    <div class="clearfix">
                        <div class="pull-left">
						<span class="img-demo">
							{{.wareName}}
						</span>
                            <div class="pull-left m-left-sm">
                                <h3 class="m-bottom-xs m-top-xs">{{.userName}}</h3>
                                <span class="text-muted">{{.userEmail}}</span>
                            </div>
                        </div>
                        <div class="pull-right">
                            <h4><strong>订单编号：#{{.orderID}}</strong></h4>
                            <strong>创建时间：{{.orderCreateTime}}</strong>
                        </div>
                    </div>
                    <hr>
                    <div class="clearfix">
                        <div class="pull-left">
                            <h4>
                                <strong>订单详情</strong>
                                {{if .paid}}
                                    <span class="label label-success">已支付</span>
                                {{else}}
                                    <span class="label label-danger">未支付</span>
                                {{end}}
                            </h4>
                            <address>
                                如有问题请联系：{{.adminAddress}}
                            </address>
                        </div>
                    </div>
                    <table class="table table-striped m-top-md" id="dataTable">
                        <thead>
                        <tr class="bg-theme">
                            <th>编号</th>
                            <th>商品名称</th>
                            <th>月付单价</th>
                            <th>购买类型</th>
                            <th>总价</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>#{{.orderID}}</td>
                            <td>{{.wareName}}</td>
                            <td>￥{{.pricePerMonth}}</td>
                            <td>{{.typeText}}</td>
                            <td>￥{{.originPrice}}</td>
                        </tr>
                        <tr>
                        </tbody>
                    </table>
                    <div class="padding-sm bg-grey">
                        <p>提示：</p>
                    </div>
                    <hr>
                    {{if .hasError}}
                        <div class="alert alert-danger">
                            <strong>激活失败！</strong> {{.hasErrorText}}
                        </div>
                    {{else if .hasSuccess}}
                        <div class="alert alert-success">
                            <strong>激活成功！</strong> 前往控制台管理服务器！
                        </div>
                    {{end}}
                </div>
                <div class="pull-right">
                    <table class="table m-top-md">
                        <tbody>
                        <tr class="no-border">
                            <td class="no-border"></td>
                            <td class="no-border"></td>
                            <td class="no-border"></td>
                            <td class="text-right no-border"><strong><font style="vertical-align: inherit;"><font
                                                style="vertical-align: inherit;">小计</font></font></strong></td>
                            <td><strong><font style="vertical-align: inherit;"><font
                                                style="vertical-align: inherit;">￥ {{.originPrice}}</font></font></strong>
                            </td>
                        </tr>
                        <tr class="no-border">
                            <td class="no-border"></td>
                            <td class="no-border"></td>
                            <td class="no-border"></td>
                            <td class="text-right no-border"><strong><font style="vertical-align: inherit;"><font
                                                style="vertical-align: inherit;">折扣</font></font></strong></td>
                            <td><strong><font style="vertical-align: inherit;"><font
                                                style="vertical-align: inherit;">￥ {{.discountPrice}}</font></font></strong>
                            </td>
                        </tr>
                        <tr class="no-border">
                            <td class="no-border"></td>
                            <td class="no-border"></td>
                            <td class="no-border"></td>
                            <td class="text-right no-border"><strong><font style="vertical-align: inherit;"><font
                                                style="vertical-align: inherit;">总</font></font></strong></td>
                            <td><strong class="text-danger"><font style="vertical-align: inherit;"><font
                                                style="vertical-align: inherit;">￥ {{.finalPrice}}</font></font></strong>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <a href="#formModal1" role="button" data-toggle="modal" class="btn btn-info btn-small"
                       {{if .paid}}disabled="disabled"{{end}}>使用余额支付</a>
                    <div class="modal fade" id="formModal1">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                    <h4>使用预购买的KEY激活服务器</h4>
                                    <small>您可以在淘宝店或发卡平台购买KEY，每个KEY只能使用一次。<br>如果KEY失效不能使用请联系网站管理员！</small>
                                </div>
                                <div class="modal-body">
                                    <form id="payByBalance" class="form-horizontal no-margin form-border">
                                        {{.xsrfData}}
                                        <!-- choose -->
                                        <div class="form-group">
                                            <label class="col-lg-2 control-label">服务器地址</label>
                                            <div class="col-lg-10">
                                                <select class="form-control" name="selected_ip">
                                                    {{range .ips}}
                                                        <option value="{{.ID}} {{.IP}}">{{.IP}}</option>
                                                    {{end}}
                                                </select>
                                                <span class="help-block">选择的地址将作为玩家在连接MC服务器时的地址</span>
                                            </div><!-- /.col -->
                                        </div>
                                        <!-- /choose -->
                                    </>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-info btn-sm"  onclick="$.get('/order/{{.orderID}}/pay-by-balance?'+$('#payByBalance').serialize(),function(data) {
                                            console.log($('#payByBalance').serialize());
                                            if (data === 'SUCCESS'){
                                                alert('支付成功！请前往控制台确认！');
                                            }else{
                                                alert('支付失败！'+data);
                                            }
                                            parent.location.reload();
                                          })
                                        ">确认支付</button>
                                </div>
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                    <a href="#formModal2" role="button" data-toggle="modal" class="btn btn-primary btn-small"
                       {{if .paid}}disabled="disabled"{{end}}>使用Key激活</a>
                    <div class="modal fade" id="formModal2">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                    <h4>使用预购买的KEY激活服务器</h4>
                                    <small>您可以在淘宝店或发卡平台购买KEY，每个KEY只能使用一次。<br>如果KEY失效不能使用请联系网站管理员！</small>
                                </div>
                                <div class="modal-body">
                                    <form method="post" id="pay" class="form-horizontal no-margin form-border">
                                        {{.xsrfData}}
                                        <div class="form-group">
                                            <div class="col-lg-2 control-label">
                                                <label>激活码</label>
                                            </div>
                                            <div class="col-lg-10">

                                                <input type="text" class="form-control input-sm" name="key"
                                                       placeholder="输入您购买到的激活码">
                                            </div>
                                            <div class="col-lg-2"></div>
                                        </div>
                                        <!-- choose -->
                                        <div class="form-group">
                                            <label class="col-lg-2 control-label">服务器地址</label>
                                            <div class="col-lg-10">
                                                <select class="form-control" name="selected_ip">
                                                    {{range .ips}}
                                                        <option value="{{.ID}} {{.IP}}">{{.IP}}</option>
                                                    {{end}}
                                                </select>
                                                <span class="help-block">选择的地址将作为玩家在连接MC服务器时的地址</span>
                                            </div><!-- /.col -->
                                        </div>
                                        <!-- /choose -->
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" form="pay" class="btn btn-info btn-sm">确认激活</button>
                                </div>
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div>
            </div>
        </div>
    </div>
</div>

<a href="" id="scroll-to-top" class="hidden-print"><i class="fa fa-chevron-up"></i></a>
{{template "tpls/perfectJS.html" .}}
</body>
</html>
